tg/gsoc-diff/refactor-prepare-calls
